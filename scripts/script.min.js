$(document).ready(function(){function e(){$("#loginScreen").animate({opacity:"0",top:"100%"},1200,"easeInQuint")}function a(a){a?(console.log("User "+a.uid+" is logged in with "+a.provider),$("#authDatas").text("Email: "+a.password.email),$("#profilePic").attr("src",a.password.profileImageURL),$("#miniEmail").text(a.password.email),uid=a.uid,email=a.password.email,e()):console.log("User is logged out")}function s(){usersRef.orderByChild("level").limitToLast(50).on("child_added",function(e){var a=e.val().name,s=e.val().points,t=e.val().loses,o=e.val().wins,r=e.val().level;e.val().uid;$("tbody").prepend("<tr><td>"+a+"</td><td>"+r+"</td><td>"+s+"</td><td>"+o+"</td><td>"+t+"</td></tr>")})}function t(){$("td").remove(),s()}function o(){userPoints+=userGain,usersRef.child(authData.uid).update({points:userPoints})}var r=new ProgressBar.Circle("#progress",{color:"#FCB03C",duration:3e3,strokeWidth:10,easing:"easeInOut",text:{value:10}});newMsgCount=0,msgOut=!1,accView=null,$(".navlink").click(function(){$("#navbar").removeClass(),$("#superWrap").removeClass(),$("body").css({overflowY:"hidden"}),$("select").attr("disabled","disabled")}),$("#accountButton").click(function(){$("#navbar").addClass("account"),$("#superWrap").addClass("account"),$("select").removeAttr("disabled")}),$("#gamba").click(function(){$("#navbar").addClass("gamba"),$("#superWrap").addClass("gamba")}),$("#leaderboard").click(function(){$("#navbar").addClass("leaderboard"),$("#superWrap").addClass("leaderboard"),$("body").css({overflowY:"auto"})}),$("#feature").click(function(){$("#navbar").addClass("feature"),$("#superWrap").addClass("feature"),$("body").css({overflowY:"auto"})}),$("#miniPic").toggle(function(){msgOut=!0,newMsgCount=0,$("#newMsg").text(newMsgCount),$("#newMsg").css({zIndex:"-1",opacity:0}),$("#miniPic").attr("src","Styling/Pictures/chat2.png"),$("#accountInfo").animate({right:"0"},600,"easeInOutExpo"),$("#messageText").focus()},function(){msgOut=!1,$("#miniPic").attr("src","Styling/Pictures/chat1.png"),$("#accountInfo").animate({right:"-500px"},600,"easeInOutExpo")});var n=new Firebase("https://it-eksamen.firebaseio.com/presence/"),u=n.push(),l=new Firebase("https://it-eksamen.firebaseio.com/.info/connected");l.on("value",function(e){e.val()&&(u.onDisconnect().remove(),u.set(!0))}),n.on("value",function(e){$("#activeUsers").animate({queue:!1,opacity:0},300),$("#activeUsers").text("Active users: "+e.numChildren()),$("#activeUsers").animate({queue:!1,opacity:1},300)});var c=new Firebase("https://it-eksamen.firebaseio.com/");if(msgRef=c.child("messages"),suggestRef=c.child("suggestions"),usersRef=c.child("users"),authData=c.getAuth(),c.onAuth(a),$("#resetButton").click(function(){$("navbar").hasClass("account")&&c.resetPassword({email:email})}),$("#createButton").click(function(){if(""!=$("#userLogin").val()&&""!=$("#passLogin").val()){var e=$("#username").val(),a=$("#password").val();usersRef.createUser({email:e,password:a},function(e,a){if(e)$("#errorText").text(e),$("#errorText").css({opacity:"1"});else{var s=["#e74c3c","#c0392b","#d35400","#e67e22","#16a085","#2ecc71","#3498db","#2980b9","#1abc9c","#8e44ad","#9b59b6","#f39c12","#f1c40f"],t=s[Math.floor(Math.random()*s.length)];$("#errorText").text("Account created"),$("#errorText").css({opacity:"1"}),c.onAuth(function(e){e&&usersRef.child(e.uid).set({name:e.password.email,points:50,wins:0,loses:0,exp:0,goal:400,level:1,color:t,bgLink:"#210002",gain:100})})}})}}),$("#loginButton").click(function(){""!=$("#username").val()&&""!=$("#password").val()&&usersRef.authWithPassword({email:$("#username").val(),password:$("#password").val()},function(e,a){e?($("#errorText").text(e),$("#errorText").css({opacity:"1"}),console.log("Login Failed!",e)):(uid=a.uid,$("#errorText").text("Account logged in"),$("#errorText").css({opacity:"1"}),$("#errorText").css({color:"#2ecc71"}),$("#authDatas").text("Email: "+a.password.email),$("#profilePic").attr("src",a.password.profileImageURL),$("#miniPic").attr("src",a.password.profileImageURL),$("#miniEmail").text(a.password.email),location.reload(!0))})}),s(),$("#refreshLeader").click(function(){$("#navbar").hasClass("leaderboard")&&t()}),authData){usersRef.child(authData.uid).on("value",function(e){snap=e.val(),userPoints=snap.points,userWins=snap.wins,userLoses=snap.loses,userLvl=snap.level,userExp=snap.exp,userColor=snap.color,userGoal=snap.goal,userGain=snap.gain,""==snap.bgLink&&(snap.bgLink="#210002"),bgLink=snap.bgLink,void 0==userGain?usersRef.child(authData.uid).update({gain:100}):userGain=snap.gain,$("option").each(function(){$(this).css({backgroundColor:$(this).val()})}),"#210002"!=bgLink&&""!=bgLink?$("#profilePic").attr("src",bgLink):$("#profilePic").attr("src",authData.password.profileImageURL),$(".authPoints").text("Points: "+userPoints),$("#accountPoints").text("Points: "+userPoints),$("#userWins").text("Wins: "+userWins),$("#userLoses").text("Loses: "+userLoses),$("#authLvl").text("Level: "+userLvl),$("#authExp").text("Experience: "+userExp),$("#authExpNeed").text("Experience needed: "+(userGoal-userExp)),userExp>userGoal&&(userExp=userGoal),userExp==userGoal&&(userLvl+=1,userExp=0,userGoal+=userGoal,userGain+=25,$("#lvlUp").text("Level up! You're now level "+userLvl),$("#lvlUp").animate({top:"50px"},600),setTimeout(function(){$("#lvlUp").animate({top:"-40px"},600)},3e3),usersRef.child(authData.uid).update({goal:userGoal,level:userLvl,exp:userExp,gain:userGain})),$(".expBar").each(function(){$(this).progressbar({max:userGoal,value:userExp}),scaledValue=userExp/userGoal,r.text=userLvl,r.set(scaledValue),$(".progressbar-text").text(userLvl)}),$(".navlink").each(function(){$(this).animate({queue:!1,color:userColor},1e3)}),$(".navlink").hover(function(){$(this).animate({queue:!1,color:"black"},20)},function(){$(this).animate({queue:!1,color:userColor},30)}),$("body").animate({queue:!1,backgroundColor:userColor},1e3),$("div.progressbar-text").animate({queue:!1,color:userColor},1e3),$("#newMsg").animate({queue:!1,backgroundColor:userColor},1e3),r.path.setAttribute("stroke",userColor),$("#wagerText").animate({queue:!1,color:userColor},1e3),$(".domButton").animate({queue:!1,color:userColor},1e3),$("#miniEmail").animate({queue:!1,color:userColor},1e3),$("#authPoints").animate({queue:!1,color:userColor},1e3),$("#messageText").animate({queue:!1,color:userColor},1e3),$(".ui-progressbar-value").animate({queue:!1,backgroundColor:userColor},1e3),$("select").animate({queue:!1,backgroundColor:userColor},1e3)},function(e){console.log("The read failed ",e.code)}),$("select").click(function(){$("#colList").css({backgroundColor:$("#colList :selected").val()}),usersRef.child(authData.uid).update({color:$("#colList :selected").val()})}),$("#gambaButton").click(function(){wager=parseInt($("#wagerText").val(),10),userPoints>=wager&&wager>0?(odds=Math.floor(100*Math.random()+1),odds<50?(userPoints-=wager,userLoses+=1):(userPoints+=wager,userExp+=wager,userWins+=1),usersRef.child(authData.uid).update({points:userPoints,loses:userLoses,wins:userWins,exp:userExp})):userPoints<wager&&($("#lvlUp").text("You need more points!"),$("#lvlUp").animate({top:"50px"},600),setTimeout(function(){$("#lvlUp").animate({top:"-40px"},600)},1500))});setInterval(o,6e4);$("#wagerText").keypress(function(e){17==e.keyCode&&(console.log(e.keyCode),$("#wagerText").val(userPoints))}),$("#messageText").keypress(function(e){if(13==e.keyCode&&""!=$("#messageText").val()){var a=$("#messageText").val(),s=new Date,t=s.getTime(),o=s.toDateString()+" "+s.getHours()+":"+s.getMinutes()+":"+s.getSeconds();if(msgRef.push({name:authData.password.email,time:o,dbTime:t,message:a,color:userColor,uid:uid,bgLink:bgLink}),"8bbdccb5-6b56-477a-8f0c-37d5a7e11b2d"==authData.uid&&-1!=a.search("!give")){var r=a.substr(6,36),i=a.substr(43);i=parseInt(i);var n;usersRef.child(r).on("value",function(e){data2=e.val(),n=data2.points,n+=i}),usersRef.child(r).update({points:n})}$("#messageText").val("")}}),msgRef.orderByChild("dbTime").limitToLast(50).on("child_added",function(e){function a(e){var a=/(https?:\/\/[^\s]+)/g;return e.replace(a,function(e){return'<a href="'+e+'">'+e+"</a>"})}var s=e.val().message,t=e.val().time,o=e.val().name,r=e.val().color,i=e.val().uid,n=e.val().bgLink,s=a(s);$("#messageCont").append("<p class='message' style='color: "+r+"; background:url("+n+") center no-repeat; background-size: 500px'>"+t+'<br><a class="accLink" style=color:'+r+' href="#'+i+'">'+o+"</a>: "+s+"</p>"),$("#messageCont").scrollTo("max",{axis:"y"}),msgOut||(newMsgCount+=1,$("#newMsg").text(newMsgCount),$("#newMsg").css({zIndex:"1",opacity:1}))}),$("#messageCont").click(function(){setTimeout(function(){accView=location.hash.slice(1),usersRef.on("value",function(e){data=e.val();for(i in data)i==accView&&(otherPoints=data[i].points,otherWins=data[i].wins,otherLoses=data[i].loses,otherLvl=data[i].level,otherExp=data[i].exp,otherGoal=data[i].goal,otherbgLink=data[i].bgLink,$(".authPoints2").text("Points: "+otherPoints),$("#otherWins").text("Wins: "+otherWins),$("#otherLoses").text("Loses: "+otherLoses),$("#authLvl2").text("Level: "+otherLvl),$("#authExp2").text("Experience: "+otherExp),$("#authExpNeed2").text("Experience needed: "+(otherGoal-otherExp)),$("#profilePic2").attr("src",otherbgLink))}),$("#navbar").removeClass(),$("#superWrap").removeClass(),$("#navbar").addClass("account2"),$("#superWrap").addClass("account2")},200)}),$("#bgSubmit").click(function(){bgLink=$("#bgLink").val(),bgLink=String(bgLink),""!=$("#bgLink").val()&&(bgLink.indexOf(!0)||-1!=bgLink.indexOf(".jpg")||-1!=bgLink.indexOf(".gif"))&&usersRef.child(authData.uid).update({bgLink:bgLink})}),$("#submitSuggest").click(function(){if(0!=$("#suggestBox").val()){suggestion=$("#suggestBox").val(),$("#suggestBox").val("");var e=new Date,a=e.getTime();suggestRef.push({suggestion:suggestion,name:authData.password.email,color:userColor,dbTime:a})}}),suggestRef.orderByChild("dbTime").limitToLast(50).on("child_added",function(e){function a(e){var a=/(https?:\/\/[^\s]+)/g;return e.replace(a,function(e){return'<a target="_blank" href="'+e+'">'+e+"</a>"})}var s=e.val().name,t=e.val().suggestion,o=e.val().color;void 0==o&&(o="black");var t=a(t);$("#featureCont").append("<div class='suggestion' style = 'color:"+o+"'>"+s+"<br><br>"+t+"<br></div>")})}$("#logOutButton").click(function(){$("#navbar").hasClass("gamba")&&(c.unauth(),location.reload(!0))})});